---
- name: Add an Apt signing key influxdb
  apt_key:
    url: https://repos.influxdata.com/influxdb.key
    state: present

- apt_repository:
    repo: deb https://repos.influxdata.com/debian stretch stable
    state: present
    mode: 600

- name: Update apt-get cache
  apt: >
    update_cache=yes
    cache_valid_time=360

- name: Update all packages to the latest version
  apt: >
    upgrade=yes

- name: install influxdb
  apt:
    name: influxdb
    state: present

- name: Make sure influxdb is running
  systemd:
    enabled: yes
    state: started
    name: influxdb